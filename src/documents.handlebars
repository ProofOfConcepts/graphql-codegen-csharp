//

#region Query

// Query start 

namespace Generated
{
    public class DateFormatConverter : IsoDateTimeConverter
    {
        public DateFormatConverter(string format)
        {
            DateTimeFormat = format;
        }
    }


    public interface IQuery
    {
        string GetQueryText();
        object GetParsedObject(string jsonText);
    }

    public interface IQuery<out T> : IQuery
    {
        new T GetParsedObject(string jsonText);
    }
}

#endregion 

{{#each operations }}

#region {{ toPascalCase name }} 

namespace Generated.{{ toPascalCase name }} 
{

    {{ toCsharpComment "Operation Type" }}
    public partial class {{ toPascalCase operationType }} : IQuery<Data>
    { 
        public {{ toPascalCase operationType }}({{{asArgumentList variables}}})
        {
      {{#each variables}}
            {{ toPascalCase name }} = {{ name }};
      {{/each}}
        }
        
        {{#each variables}}       
        public {{{ convertedType this }}} {{ toPascalCase name }} { get; }
        {{/each}}

        public virtual string GetQueryText()
        {
            return JsonConvert.SerializeObject(new
            {
                query = @"{{asQueryUnescapedText document}}",
                variables = new {
{{#each variables}}                        {{ name }} = {{ toPascalCase name }}{{{ converterIfNeeded this }}},
{{/each}}
                    }
                });
            }  

            public virtual Data GetParsedObject(string jsonText)
            {
                return JsonConvert.DeserializeObject<Result>(jsonText).Data;
            }

            string IQuery.GetQueryText()
            {
                return GetQueryText();
            }

            Data IQuery<Data>.GetParsedObject(string jsonText)
            {
                return GetParsedObject(jsonText);
            }

            object IQuery.GetParsedObject(string jsonText)
            {
                return GetParsedObject(jsonText);
            }
        }

        public sealed class Result
        {
            [JsonProperty("data")]
            public Data Data { get; set; }
        }

        public sealed class Data
        {
      {{#if hasFields}}    
            {{> selectionSet fields }}
      {{/if}}  
        }

        {{> fragments this }}
      {{#each innerModels }}
        {{ toCsharpComment "Inner Model" }} 
        public sealed class {{ modelType }} 
        {
      {{#if hasFields}}     
            {{> selectionSet fields }}
        }{{/if}}{{> fragments this }}
      {{/each}}
}

#endregion

{{/each}}

#region fragments

{{#each fragments }}

namespace Generated.{{name}} {
    public sealed class Fragment
    {
{{#if hasFields}} {
    {{> selectionSet fields }}
  }{{/if}}{{> fragments this }}
  {{#each innerModels }}

    public sealed class {{ modelType }} 
    {
{{#if hasFields}} { 
    {{> selectionSet fields }}
  }{{/if}}{{> fragments this }}
  {{/each}}
}
{{/each}}

#endregion
